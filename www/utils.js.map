{"version":3,"file":"utils.js","sourceRoot":"","sources":["../scripts/utils.ts"],"names":[],"mappings":"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","sourcesContent":["/**\r\n * Copyright 2020 Huawei Technologies Co., Ltd.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *      http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport { exec } from 'cordova';\r\n\r\nconst TAG = 'hms-ads-kit'\r\n\r\nexport function asyncExec(clazz: string, func: string, args: any[] = []): Promise<any> {\r\n  return new Promise((resolve, reject) => {\r\n    exec(resolve, reject, clazz, func, args);\r\n  });\r\n};\r\n\r\n\r\ntype Handler = (data: any) => void\r\n\r\ndeclare global {\r\n  interface Window {\r\n    hmsEventHandlers: {\r\n      [key: string]: Handler[]\r\n    },\r\n    hmsEventHandler: (eventName: string, data: any) => void,\r\n    registerHMSEvent: (eventName: string, handler: Handler) => void,\r\n    unregisterHMSEvent: (eventName: string, handler: Handler) => void,\r\n    hmsSetConstants: (objName: string, constants: any) => void,\r\n    [key: string]: any\r\n  }\r\n}\r\n\r\n//ATtypes/cordova\r\nfunction initHMS() {\r\n  console.log(`${TAG} :: init called`)\r\n  initEventHandler()\r\n  initConstantSetter()\r\n}\r\n\r\nfunction initEventHandler() {\r\n  if (window.hmsEventHandler != null) return\r\n\r\n  console.log(`${TAG} :: window.hmsEventHandler`)\r\n  window.hmsEventHandlers = {}\r\n\r\n  window.hmsEventHandler = (eventName, data) => {\r\n    console.log('eventReceived: ' + eventName + ' with data: ', data)\r\n    if (window.hmsEventHandlers.hasOwnProperty(eventName)) {\r\n      window.hmsEventHandlers[eventName].forEach((handler: Handler) => {\r\n        handler(data)\r\n      })\r\n    }\r\n  }\r\n\r\n  window.registerHMSEvent = (eventName, handler) => {\r\n    if (window.hmsEventHandlers.hasOwnProperty(eventName))\r\n      window.hmsEventHandlers[eventName].push(handler)\r\n    else\r\n      window.hmsEventHandlers[eventName] = [handler]\r\n  }\r\n\r\n\r\n  // Original JS code initializes it to an empty array if handler is (false)\r\n  window.unregisterHMSEvent = (eventName, handler) => {\r\n    if (window.hmsEventHandlers.hasOwnProperty(eventName)) {\r\n      const idx = window.hmsEventHandlers[eventName].indexOf(handler)\r\n      if (idx > -1)\r\n        window.hmsEventHandlers[eventName].splice(idx, 1)\r\n    }\r\n  }\r\n\r\n}\r\n\r\n\r\nfunction initConstantSetter() {\r\n  if (window.hmsSetConstants != null) return\r\n\r\n  console.log(`${TAG} :: window.hmsSetConstants`)\r\n  window.hmsSetConstants = (objName: string, constants) => {\r\n    console.log(`${TAG} :: initializing constants for`, objName, 'with', constants)\r\n\r\n    if (window[objName] == null) {\r\n      console.log(`${TAG} :: uninitialized object`)\r\n      return\r\n    }\r\n\r\n    Object.keys(constants).forEach(key => {\r\n      Object.defineProperty(window[objName], key, { value: constants[key] })\r\n    })\r\n  }\r\n}\r\n\r\n\r\ninitHMS()\r\n\r\nexport abstract class Ads {\r\n\r\n  id: number;\r\n  objectName: string;\r\n  constructor(objectName: string = 'ads') {\r\n    this.id = null;\r\n    this.objectName = objectName;\r\n    console.log(`New ads object created, objType=${this.objectName}..`)\r\n  }\r\n\r\n  on(eventName: any, handler: () => void): void {\r\n    const instanceEventName = `${eventName}-${this.id}`\r\n    console.log(`${this.objectName} :: ${instanceEventName} -> event registeration started..`)\r\n    window.unregisterHMSEvent(instanceEventName, handler);\r\n    window.registerHMSEvent(instanceEventName, handler);\r\n  }\r\n\r\n\r\n  async create(options: any): Promise<Ads> {\r\n    console.log(`${this.objectName} ads creation started..`)\r\n\r\n\r\n    if (this.id != null)\r\n      return this\r\n\r\n    const result = await asyncExec('HMSAds', 'createAd', [this.objectName, options])\r\n    this.id = result.id\r\n    console.log(`${this.objectName} ads creation result id=${this.id}`)\r\n    return this\r\n  }\r\n\r\n\r\n  protected call(funcName: string, opts: any = {}) {\r\n    console.log(`callAdFunction :: ${funcName} -> function called by object=${this.objectName}`)\r\n    return asyncExec('HMSAds', 'callAdFunction', [this.objectName, this.id, funcName, opts])\r\n  }\r\n\r\n}"]}